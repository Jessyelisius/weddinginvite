<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/style.css">
    <title>Invitation-Form</title>
</head>
<body class="dashboard-body">
    
    <% if (message) { %>
        <div class="alert alert-danger text-center mt-3"><%= message %></div>
      <% } %><br><br>
      <h1 class="dashboard-title">Invitees List</h1>
    
      <table class="dashboard-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Full Name</th>
            <th>Phone Number</th>
            <th>Registered At</th>
            <th>View Link</th>
            <th>Get QRCOde</th>
            <th>Share Invitation</th>

          </tr>
        </thead>
        <tbody id="inviteeTable">
          <!-- Invitees will be loaded here -->
            <% if( invitees && invitees.length > 0){%>
              <% invitees.forEach((invite, index) => { %>
                <tr>
                  <td><%= index + 1 %></td>
                  <td><%= invite.FullName %></td>
                  <td><%= invite.PhoneNo %></td>
                  <td><%= new Date(invite.createdAt).toLocaleString() %></td>
                  <td><a href="/invite?username=<%= invite.FullName %>" style="color: rgb(29, 74, 133);">Open</a></td>
                  <td><a download="<%= invite.FullName %>.png" href="https://api.qrserver.com/v1/create-qr-code/?size=500x500&download=1&data=<%= encodeURIComponent(link + '/invite?username=' + invite.FullName) %>"  style="color: rgb(29, 74, 133);" >download</a></td>
                  <td>
                    <!-- Share Button -->
                    <button onclick="shareInvite('<%= link %>/invite?username=<%= encodeURIComponent(invite.FullName) %>')"
                            style="color: rgb(29, 74, 133); background: none; border: none; cursor: pointer;">
                       Share Invite
                    </button>
                  </td>
                </tr>
              <% }) %>
            <% } else { %>
              <p></p>
            <% } %>
        </tbody>
      </table>
      <div class="nav-buttons">
      <button class="nav-button"><a href="/inviteForm">Invitation-Form</a></button>

        <button class="nav-button" onclick="prevPage()"><a href="/">invite-card</a></button>
      </div>
    
      <script>
        async function shareInvite(url) {
          try {
            await navigator.share({
              title: 'Join me!',
              text: `Celebrate with me at my wedding, click the lin to grab your invitations!`,
              url: url
            });
          } catch (err) {
            // Fallback for browsers without Web Share API
            copyToClipboard(url);
            alert('Link copied to clipboard!');
          }
        }
        
        function copyToClipboard(text) {
          navigator.clipboard.writeText(text).catch(err => {
            // Ultimate fallback
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
          });
        }
        </script>
    <!-- <script>
      async function loadInvitees() {
        try {
          const res = await fetch('/api/invitees');
          const invitees = await res.json();
          const table = document.getElementById('inviteeTable');
    
          if (invitees.length === 0) {
            table.innerHTML = `<tr><td colspan="3">No invitees yet.</td></tr>`;
          } else {
            invitees.forEach(invitee => {
              const row = `
                <tr>
                  <td>${invitee.fullname}</td>
                  <td>${invitee.phoneno}</td>
                  <td>${new Date(invitee.createdAt).toLocaleString()}</td>
                </tr>
              `;
              table.innerHTML += row;
            });
          }
        } catch (error) {
          console.error('Error fetching invitees:', error);
          document.getElementById('inviteeTable').innerHTML = `<tr><td colspan="3">Failed to load invitees.</td></tr>`;
        }
      }
    
      // Load invitees when page loads
      loadInvitees();
    </script> -->
    
</body>
</html>